{
  "comments": [
    "Tests covering the addition of ROWOFFSET and ROWPARTITION as pseudocolumns"
  ],
  "tests": [
    {
      "name": "should recognize rowoffset as reserved column in new source streams",
      "properties":{
        "ksql.rowpartition.rowoffset.enabled": true
      },
      "statements": [
        "CREATE STREAM INPUT (id int KEY, name ROWOFFSET) WITH (kafka_topic='test_topic', value_format='JSON');"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "ROWOFFSET is a reserved system column name"
      }
    },
    {
      "name": "should recognize rowpartition as reserved column in new source streams",
      "properties":{
        "ksql.rowpartition.rowoffset.enabled": true
      },
      "statements": [
        "CREATE STREAM INPUT (id int KEY, name ROWPARTITION) WITH (kafka_topic='test_topic', value_format='JSON');"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "ROWPARTITION is a reserved system column name"
      }
    },
    {
      "name": "should recognize rowoffset as reserved column in new sink streams",
      "properties":{
        "ksql.rowpartition.rowoffset.enabled": true
      },
      "statements": [
        "CREATE STREAM INPUT (id int KEY, name val) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT AS SELECT, name AS ROWOFFSET FROM INPUT;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "ROWOFFSET is a reserved system column name"
      }
    },
    {
      "name": "should recognize rowpartition as reserved column in new source streams",
      "properties":{
        "ksql.rowpartition.rowoffset.enabled": true
      },
      "statements": [
        "CREATE STREAM INPUT (id int KEY, name val) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT AS SELECT, name AS ROWPARTITION FROM INPUT;"
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlException",
        "message": "ROWPARTITION is a reserved system column name"
      }
    },
    {
      "name": "NEXT TEST",
      "properties": {
        "ksql.rowpartition.rowoffset.enabled": true
      },
      "statements": [
        "CREATE STREAM INPUT (id int KEY, name STRING) WITH (kafka_topic='test_topic', value_format='JSON');",
        "CREATE STREAM OUTPUT AS SELECT id as ID_COPY, NAME FROM INPUT;"
      ],
      "inputs": [
        {
          "topic": "test_topic",
          "key": 8,
          "value": {
            "name": "a"
          }
        }
      ],
      "outputs": [
        {
          "topic": "OUTPUT",
          "key": 8,
          "value": {
            "NAME": "a"
          }
        }
      ],
      "post": {
        "sources": [
          {
            "name": "OUTPUT",
            "type": "stream",
            "schema": "ID_COPY INT KEY, NAME STRING"
          }
        ]
      }
    }
  ]
}